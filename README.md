# 微店订单自动化导出工具 (V1)

本项目是一个使用 Python 和 Selenium 实现的自动化工具，旨在从微店网页版抓取指定账号的订单信息，并将结果（包含订单详情截图）导出为格式化的 Excel 文件。同时，项目还包含一个独立的修复工具，用于对因网络或Cookie失效导致截图失败的订单进行补全。

---

## ✨ 功能特性

- **自动化登录**：通过注入Cookie实现免密登录，安全便捷。
- **高速数据采集**：采用`selenium-wire`捕获XHR请求的JSON数据，避免了缓慢的页面解析，实现高效数据抓取。
- **精准截图**：自动访问每个订单详情页，通过页面缩放和图像裁剪，生成干净、信息集中的订单截图。
- **完美Excel导出**：
    - 将所有采集到的数据（商品名、规格、订单状态等）写入`.xlsx`文件。
    - 将处理过的截图**嵌入**到Excel中，并锚定在对应订单的单元格。
    - 自动设置单元格格式，实现美观的视觉呈现。
- **健壮的修复机制**：提供独立的`patcher.py`脚本，可以读取不完整的Excel报告，为缺失截图的订单进行**增量式、原地**的截图补充。

---

## 🚀 快速开始

### 1. 环境准备

本项目依赖 Python 3 环境 (推荐 3.11 以确保 `selenium-wire` 依赖稳定)。首先，请确保已安装所有必需的第三方库。

```bash
# 安装所有依赖
pip install -r requirements.txt
```

*`requirements.txt` 文件应包含以下内容:*
```
selenium-wire
webdriver-manager
pandas
xlsxwriter
Pillow
openpyxl
```

### 2. 运行主程序 (`weidian-scraper.py`)

这是完成从0到1数据采集的主要脚本。

#### a. 配置

打开 `weidian-scraper.py` 文件，找到文件末尾的 `if __name__ == "__main__":` 部分。

- **更新Cookie**: 将 `MY_COOKIE` 变量的值，替换为您从浏览器中获取的、最新的有效Cookie字符串。
- **设置抓取深度**: 修改 `CLICKS_TO_PERFORM` 变量的值，以控制需要抓取的订单页数 (`0` 代表只抓取首页)。

#### b. 运行

完成配置后，直接在命令行中运行：

```bash
python weidian-scraper.py
```

程序执行完毕后，将在项目根目录下生成 `screenshots` 文件夹和 `微店订单导出.xlsx` 文件。

---

## 🛠️ 异常修复工具 (`patcher.py`)

当主程序因为Cookie中途失效等原因，导致生成的Excel文件中部分订单的截图是白屏或缺失时，可以使用此工具进行修复。**它不会重新抓取文字信息，只会为指定的订单补充截图。**

### a. 何时使用

- 主程序运行中断，只完成了一部分截图。
- 生成的Excel报告中，大量截图显示为登录页或空白页。

### b. 配置

打开 `patcher.py` 文件，找到顶部的 **用户配置区**。

1.  `EXCEL_FILE_PATH`: 填入需要修复的那个Excel文件名（例如 `微店订单导出.xlsx`）。
2.  `ORDER_ID_COLUMN_NAME`: 确保这个值与您Excel文件中存放订单号的列名完全一致。
3.  `SCREENSHOT_COLUMN_LETTER`: 指定您想把截图放入哪一列（例如 'P'）。
4.  `START_ROW`: 指定从Excel的第几行开始检查。
5.  `MAX_RUNS`: 本次最多修复多少个订单，用于测试。
6.  `MY_COOKIE`: **非常重要**，在此处粘贴您最新的、有效的Cookie。

### c. 运行

配置完成后，在命令行中运行：

```bash
python patcher.py
```

脚本会**直接修改并保存**您指定的Excel文件，将新生成的截图插入到对应的单元格中。

---

## 📝 后续操作建议

生成的 `微店订单导出.xlsx` 文件可以直接在 WPS Office 或 Microsoft Excel 中打开。

如需将截图转换为WPS的“单元格图片”以进行VLOOKUP等高级操作，请按照以下步骤进行批量转换：

1.  在WPS中打开文件。
2.  点击菜单栏 `开始` -> `查找和选择` -> `定位条件`。
3.  在弹出的对话框中选择 `对象` 并确定。
4.  在任意一张被选中的图片上右键，选择 `将图片置于单元格中`。

WPS将自动完成所有图片的转换和行高的最终适配。